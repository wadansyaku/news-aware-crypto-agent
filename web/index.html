<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>News-aware Crypto Agent</title>
    <link rel="stylesheet" href="/static/styles.css?v=3" />
    <script defer src="/static/app.js?v=3"></script>
  </head>
  <body>
    <div class="bg">
      <div class="glow glow-a"></div>
      <div class="glow glow-b"></div>
      <div class="grain"></div>
    </div>

    <header class="hero">
      <div class="hero-top">
        <div class="brand">
          <span class="brand-mark">NCA</span>
          <span class="brand-text">News-aware Crypto Agent</span>
        </div>
        <nav class="hero-nav">
          <details class="nav-group">
            <summary>📊 見る</summary>
            <div class="nav-links">
              <a href="#overview">概要</a>
              <a href="#watchlist">ウォッチ</a>
              <a href="#portfolio">ポートフォリオ</a>
            </div>
          </details>
          <details class="nav-group">
            <summary>💹 取引</summary>
            <div class="nav-links">
              <a href="#ingest">取り込み</a>
              <a href="#plan">提案</a>
              <a href="#approval">承認</a>
              <a href="#execute">実行</a>
            </div>
          </details>
          <details class="nav-group">
            <summary>📈 分析</summary>
            <div class="nav-links">
              <a href="#report">レポート</a>
              <a href="#analysis">分析</a>
              <a href="#backtest">バックテスト</a>
              <a href="#news">ニュース</a>
              <a href="#audit">監査</a>
            </div>
          </details>
          <details class="nav-group">
            <summary>⚙️ 設定</summary>
            <div class="nav-links">
              <a href="#guide">取引所ガイド</a>
            </div>
          </details>
        </nav>
      </div>
      <div class="hero-body">
        <div class="hero-copy">
          <h1>ニュースと価格を、安全に検証して取引へ。</h1>
          <p>
            これは研究・検証向けのローカルファーストMVPです。利益を保証しません。必ず
            <strong>承認フロー</strong>を経てから実行されます。
          </p>
          <div class="hero-actions">
            <button class="btn btn-primary" id="refresh-status">ステータス更新</button>
            <button class="btn btn-ghost" id="quick-ingest">今すぐ取り込み</button>
          </div>
          <div class="status-strip">
            <div class="status-pill" id="status-exchange">取引所: 取得中</div>
            <div class="status-pill" id="status-news">ニュース: 取得中</div>
            <div class="status-pill" id="status-db">DB: 取得中</div>
          </div>
        </div>
        <div class="hero-panel">
          <div class="panel-card">
            <div class="panel-title">安全モード</div>
            <div class="panel-grid">
              <div>
                <span class="label" title="練習モードは実際のお金を使いません">運用モード</span>
                <strong id="cfg-mode">-</strong>
              </div>
              <div>
                <span class="label" title="取引実行前に人の確認が必要です">承認必須</span>
                <strong id="cfg-approval">-</strong>
              </div>
              <div>
                <span class="label" title="条件を満たすと自動で実行します">自動実行</span>
                <strong id="cfg-autopilot">-</strong>
              </div>
              <div>
                <span class="label" title="すべての取引を緊急停止します">緊急停止</span>
                <strong id="cfg-kill">-</strong>
              </div>
            </div>
            <div class="panel-foot">
              <div>
                <span class="label" title="1日の損失がこの金額に達すると取引を止めます">日次損失上限</span>
                <strong id="cfg-daily-loss">-</strong>
              </div>
              <div>
                <span class="label" title="1日に実行できる注文の上限です">最大注文/日</span>
                <strong id="cfg-max-orders">-</strong>
              </div>
            </div>
            <div class="panel-subtle" id="cfg-orders-used">本日実行数: - / -</div>
            <div class="panel-actions">
              <button class="btn btn-ghost" id="open-safety-modal">安全設定を編集</button>
            </div>
          </div>
          <div class="panel-card">
            <div class="panel-title">現在ポジション</div>
            <div class="panel-grid">
              <div>
                <span class="label">シンボル</span>
                <strong id="pos-symbol">-</strong>
              </div>
              <div>
                <span class="label">数量</span>
                <strong id="pos-size">-</strong>
              </div>
              <div>
                <span class="label">平均価格</span>
                <strong id="pos-avg">-</strong>
              </div>
              <div>
                <span class="label">現在価格</span>
                <strong id="pos-current">-</strong>
              </div>
              <div>
                <span class="label" title="今すぐ売った場合の損益目安です">含み損益</span>
                <strong id="pos-unrealized">-</strong>
              </div>
              <div>
                <span class="label" title="平均価格に対する現在価格の変化率です">損益率</span>
                <strong id="pos-return">-</strong>
              </div>
              <div>
                <span class="label">保有期間</span>
                <strong id="pos-hold">-</strong>
              </div>
              <div>
                <span class="label">最終更新</span>
                <strong id="pos-price-ts">-</strong>
              </div>
            </div>
            <div class="panel-foot">
              <div class="compare">
                <span class="label" title="平均価格と現在価格の比較です">平均 vs 現在</span>
                <div class="compare-bar">
                  <div class="compare-fill" id="pos-compare"></div>
                </div>
              </div>
              <div class="gauge">
                <canvas id="risk-gauge" height="90"></canvas>
                <span class="label" title="資本に対する持ち高の割合です">エクスポージャー</span>
                <strong id="pos-exposure">-</strong>
              </div>
            </div>
            <div class="panel-actions">
              <button class="btn btn-ghost" id="close-position">全ポジション解消</button>
            </div>
            <div class="panel-subtle" id="pos-message"></div>
          </div>
        </div>
      </div>
    </header>

    <main class="grid">
      <section class="card" id="overview" data-step="0">
        <div class="card-head">
          <h2>クイック概要</h2>
          <p>ここから現在の状態を把握し、次のアクションへ。</p>
        </div>
        <div class="stat-grid">
          <div class="stat">
            <span class="label">取引所</span>
            <strong id="cfg-exchange">-</strong>
          </div>
          <div class="stat">
            <span class="label">対象シンボル</span>
            <strong id="cfg-symbols">-</strong>
          </div>
          <div class="stat">
            <span class="label">足種</span>
            <strong id="cfg-timeframes">-</strong>
          </div>
              <div class="stat">
            <span class="label" title="承認時に使うフレーズです。安全のため非表示です">承認フレーズ</span>
            <div class="inline">
              <strong id="cfg-phrase">非表示</strong>
              <button class="link" id="show-phrase" title="開発者向けの確認用に表示します">表示（開発者向け）</button>
            </div>
          </div>
        </div>
        <div class="callout">
          <strong>初めての流れ</strong>
          <div class="callout-steps">取り込み → 提案 → 承認 → 実行</div>
          <div class="label">まずは練習モードで確認してください。</div>
        </div>
        <div class="divider"></div>
        <div class="mini-list" id="intents-preview"></div>
        <div class="divider"></div>
        <div class="runner-card" id="runner-card">
          <div class="runner-head">
            <strong>自動取り込み・提案</strong>
            <span class="label" id="runner-state">未起動</span>
          </div>
          <div class="runner-light">
            <span class="status-pill" id="light-market">市場: -</span>
            <span class="status-pill" id="light-news">ニュース: -</span>
          </div>
          <div class="runner-meta">
            <span>市場: <span id="runner-market-at">-</span></span>
            <span>ニュース: <span id="runner-news-at">-</span></span>
            <span>提案: <span id="runner-propose-at">-</span></span>
          </div>
          <div class="runner-actions">
            <select id="runner-strategy">
              <option value="baseline">価格のみ（baseline）</option>
              <option value="news_overlay">ニュース重視（overlay）</option>
            </select>
            <button class="btn btn-primary" id="runner-start">開始</button>
            <button class="btn btn-ghost" id="runner-stop">停止</button>
          </div>
          <div class="runner-actions">
            <button class="btn btn-ghost" id="open-frequency-modal">更新頻度を編集</button>
          </div>
          <div class="panel-subtle">実行は自動化されません（承認が必要です）。</div>
          <details class="runner-hint">
            <summary>開発者向け情報を表示</summary>
            <code>uv run trade-agent run --strategy news_overlay</code>
          </details>
        </div>
      </section>

      <section class="card" id="watchlist" data-step="1">
        <div class="card-head">
          <h2>ウォッチリストとアラート</h2>
          <p>複数シンボルの価格を監視し、条件で通知します。</p>
        </div>
        <div class="watchlist-grid">
          <div class="watchlist-panel">
            <div class="panel-head">
              <div>
                <h3>ウォッチリスト</h3>
                <span class="label">最新価格と変動率</span>
              </div>
              <button class="btn btn-ghost" id="watchlist-refresh">更新</button>
            </div>
            <div class="table-wrap">
              <table class="table" id="watchlist-table">
                <thead>
                  <tr>
                    <th>シンボル</th>
                    <th>現在価格</th>
                    <th title="直近価格の変化率です">変動率</th>
                    <th>更新</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
          <div class="watchlist-panel">
            <div class="panel-head">
              <div>
                <h3>価格アラート</h3>
                <span class="label">条件に一致すると通知します</span>
              </div>
              <div class="panel-actions">
                <button class="btn btn-primary" id="open-alert-modal">アラート追加</button>
                <button class="btn btn-ghost" id="enable-notify">通知を有効化</button>
              </div>
            </div>
            <div class="panel-subline">
              <span class="label" id="notify-status">通知: 未許可</span>
            </div>
            <div class="alert-list" id="alerts-list"></div>
            <div class="output" id="alert-output"></div>
          </div>
        </div>
      </section>

      <section class="card" id="portfolio" data-step="2">
        <div class="card-head">
          <h2>ポートフォリオ</h2>
          <p>複数シンボルの保有状況と配分を確認します。</p>
        </div>
        <div class="portfolio-summary">
          <div class="summary-card">
            <span class="label">合計評価額</span>
            <strong id="portfolio-total">-</strong>
          </div>
          <div class="summary-card">
            <span class="label" title="今すぐ売った場合の損益目安です">合計含み損益</span>
            <strong id="portfolio-pnl">-</strong>
          </div>
        </div>
        <div class="chart-card">
          <canvas id="portfolio-chart" height="160"></canvas>
        </div>
        <div class="legend" id="portfolio-legend"></div>
        <div class="table-wrap">
          <table class="table" id="portfolio-table">
            <thead>
              <tr>
                <th>シンボル</th>
                <th>数量</th>
                <th>平均価格</th>
                <th>現在価格</th>
                <th>評価額</th>
                <th title="今すぐ売った場合の損益目安です">含み損益</th>
                <th>配分</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section class="card" id="ingest" data-step="3">
        <div class="card-head">
          <h2>データ取り込み</h2>
          <p>市場価格とニュースを最新化します。</p>
        </div>
        <form id="ingest-form" class="form">
          <div class="form-grid">
            <label>
              <span>対象シンボル</span>
              <input type="text" id="ingest-symbol" placeholder="BTC/JPY" />
            </label>
            <label class="checkbox">
              <input type="checkbox" id="ingest-orderbook" />
              <span>板情報も取得する</span>
            </label>
            <label class="checkbox">
              <input type="checkbox" id="ingest-news-only" />
              <span>ニュースのみ</span>
            </label>
            <label class="checkbox">
              <input type="checkbox" id="ingest-features-only" />
              <span>特徴量のみ</span>
            </label>
          </div>
          <button class="btn btn-primary" type="submit">取り込み開始</button>
        </form>
        <div class="output" id="ingest-output"></div>
      </section>

      <section class="card" id="plan" data-step="4">
        <div class="card-head">
          <h2>取引提案</h2>
          <p>戦略からトレードプランを生成します。</p>
        </div>
        <form id="propose-form" class="form">
          <div class="form-grid">
            <label>
              <span>戦略</span>
              <select id="propose-strategy">
                <option value="baseline">価格のみ（baseline）</option>
                <option value="news_overlay">ニュース重視（overlay）</option>
              </select>
            </label>
            <label>
              <span title="練習モードは実際のお金を使いません">モード</span>
              <select id="propose-mode">
                <option value="paper">練習モード</option>
                <option value="live">本番モード</option>
              </select>
            </label>
            <label>
              <span>対象シンボル</span>
              <input type="text" id="propose-symbol" placeholder="BTC/JPY" />
            </label>
            <label class="checkbox">
              <input type="checkbox" id="propose-refresh" />
              <span>直近のローソクも更新</span>
            </label>
          </div>
          <button class="btn btn-primary" type="submit">提案を作成</button>
        </form>
        <div class="output" id="propose-output"></div>
      </section>

      <section class="card" id="approval" data-step="5">
        <div class="card-head">
          <h2>承認</h2>
          <p>提案された取引を確認し、承認フレーズで許可します。</p>
        </div>
        <div class="table-wrap">
          <table class="table" id="intents-table">
            <thead>
              <tr>
                <th>日時</th>
                <th>シンボル</th>
                <th>方向</th>
                <th>サイズ</th>
                <th>価格</th>
                <th>状態</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <form id="approve-form" class="form">
          <div class="form-grid">
            <label>
              <span title="提案を識別するIDです">提案ID</span>
              <input type="text" id="approve-intent" placeholder="最新の提案IDを入力" />
            </label>
            <div class="note">
              <span class="label">承認フレーズ</span>
              <div>保存済みのフレーズを自動で使用します。</div>
            </div>
            <label>
              <span>実行モード</span>
              <select id="approve-execute-mode">
                <option value="paper">練習モード</option>
                <option value="live">本番モード</option>
              </select>
            </label>
          </div>
          <div class="form-actions">
            <button class="btn btn-primary" type="submit" data-action="approve">承認する</button>
            <button class="btn btn-ghost" type="submit" data-action="approve-execute">承認して実行</button>
          </div>
        </form>
        <div class="output" id="approve-output"></div>
      </section>

      <section class="card" id="execute" data-step="6">
        <div class="card-head">
          <h2>実行</h2>
          <p>承認済みの取引を実行します（デフォルトは練習モード）。</p>
        </div>
        <form id="execute-form" class="form">
          <div class="form-grid">
            <label>
              <span title="未入力なら最新の提案を実行します">提案ID（任意）</span>
              <input type="text" id="execute-intent" placeholder="未入力なら最新" />
            </label>
            <label>
              <span>モード</span>
              <select id="execute-mode">
                <option value="paper">練習モード</option>
                <option value="live">本番モード</option>
              </select>
            </label>
          </div>
          <button class="btn btn-primary" type="submit">実行する</button>
        </form>
        <div class="output" id="execute-output"></div>
      </section>

      <section class="card" id="report" data-step="7">
        <div class="card-head">
          <h2>レポートと損益</h2>
          <p>成績の推移を視覚的に確認します。</p>
        </div>
        <form id="report-form" class="form">
          <div class="form-grid">
            <label>
              <span>対象モード</span>
              <select id="report-mode">
                <option value="">すべて</option>
                <option value="paper">練習モード</option>
                <option value="live">本番モード</option>
              </select>
            </label>
          </div>
          <div class="form-actions">
            <button class="btn btn-primary" type="submit">レポートを生成</button>
            <button class="btn btn-ghost" type="button" id="refresh-analytics">最新を表示</button>
          </div>
        </form>
        <div class="output" id="report-output"></div>
        <div class="metrics" id="metrics-grid"></div>
        <div class="chart-card">
          <canvas id="equity-chart" height="180"></canvas>
        </div>
        <div class="table-wrap">
          <table class="table" id="trades-table">
            <thead>
              <tr>
                <th>日時</th>
                <th>モード</th>
                <th>シンボル</th>
                <th>方向</th>
                <th>サイズ</th>
                <th>価格</th>
                <th title="この取引の損失/利益です">損益</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section class="card" id="analysis" data-step="8">
        <div class="card-head">
          <h2>投資分析</h2>
          <p>日次成績・提案の当たり外れ・外部口座を一画面で確認します。</p>
        </div>
        <form id="analysis-form" class="form">
          <div class="form-grid">
            <label>
              <span>開始日</span>
              <input type="date" id="analysis-start" />
            </label>
            <label>
              <span>終了日</span>
              <input type="date" id="analysis-end" />
            </label>
            <label>
              <span>対象モード</span>
              <select id="analysis-mode">
                <option value="">すべて</option>
                <option value="paper">練習モード</option>
                <option value="live">本番モード</option>
              </select>
            </label>
            <label>
              <span>シンボル</span>
              <input type="text" id="analysis-symbol" placeholder="BTC/JPY" />
            </label>
          </div>
          <div class="form-actions">
            <button class="btn btn-primary" type="submit">分析を更新</button>
            <button class="btn btn-ghost" type="button" id="refresh-analysis">最新を表示</button>
            <button class="btn btn-ghost" type="button" id="external-ingest">外部口座を取り込む</button>
          </div>
        </form>
        <div class="output" id="analysis-output"></div>
        <div class="analysis-grid">
          <div>
            <div class="metrics" id="analysis-metrics"></div>
            <div class="summary-grid" id="analysis-strategy-summary"></div>
          </div>
          <div class="chart-card">
            <canvas id="analysis-daily-chart" height="180"></canvas>
          </div>
        </div>
        <div class="table-wrap">
          <table class="table" id="analysis-daily-table">
            <thead>
              <tr>
                <th>日付</th>
                <th title="1日ごとの損失/利益です">日次損益</th>
                <th title="累積の損失/利益です">累積</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="analysis-subhead">内部取引ログ</div>
        <div class="table-wrap">
          <table class="table" id="analysis-trades-table">
            <thead>
              <tr>
                <th>日時</th>
                <th>モード</th>
                <th>シンボル</th>
                <th>方向</th>
                <th>サイズ</th>
                <th>価格</th>
                <th title="この取引の損失/利益です">損益</th>
                <th>戦略</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="analysis-subhead">提案と結果の差分</div>
        <div class="summary-grid" id="intent-summary"></div>
        <div class="table-wrap">
          <table class="table" id="intent-table">
            <thead>
              <tr>
                <th>日時</th>
                <th>提案ID</th>
                <th>シンボル</th>
                <th>方向</th>
                <th title="提案時に想定した価格です">意図価格</th>
                <th title="実際に約定した価格です">約定価格</th>
                <th title="意図数量に対する約定率です">充足率</th>
                <th title="意図価格と約定価格の差です">スリッページ</th>
                <th title="この取引の損失/利益です">損益</th>
                <th>結果</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="analysis-subhead">外部口座（読み取り専用）</div>
        <div class="analysis-grid">
          <div class="panel-card">
            <div class="panel-title">残高サマリ</div>
            <div class="summary-grid" id="external-summary"></div>
            <div class="table-wrap">
              <table class="table" id="external-balances-table">
                <thead>
                  <tr>
                    <th>通貨</th>
                    <th>合計</th>
                    <th>利用可能</th>
                    <th>拘束</th>
                    <th>概算JPY</th>
                    <th>更新</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
          <div class="panel-card">
            <div class="panel-title">外部取引の成績</div>
            <div class="metrics" id="external-metrics"></div>
            <div class="chart-card">
              <canvas id="external-daily-chart" height="180"></canvas>
            </div>
            <div class="table-wrap">
              <table class="table" id="external-trades-table">
                <thead>
                  <tr>
                    <th>日時</th>
                    <th>シンボル</th>
                    <th>方向</th>
                    <th>サイズ</th>
                    <th>価格</th>
                    <th title="この取引の損失/利益です">損益</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="output" id="external-output"></div>
      </section>

      <section class="card" id="backtest" data-step="9">
        <div class="card-head">
          <h2>バックテストダッシュボード</h2>
          <p>過去データでの戦略パフォーマンスを可視化します。</p>
        </div>
        <form id="backtest-form" class="form">
          <div class="form-grid">
            <label>
              <span>開始日</span>
              <input type="date" id="backtest-start" />
            </label>
            <label>
              <span>終了日</span>
              <input type="date" id="backtest-end" />
            </label>
            <label>
              <span>戦略</span>
              <select id="backtest-strategy">
                <option value="baseline">価格のみ（baseline）</option>
                <option value="news_overlay">ニュース重視（overlay）</option>
              </select>
            </label>
            <label>
              <span>シンボル</span>
              <input type="text" id="backtest-symbol" placeholder="BTC/JPY" />
            </label>
          </div>
          <div class="form-actions">
            <button class="btn btn-primary" type="submit">バックテスト実行</button>
            <button class="btn btn-ghost" type="button" id="refresh-backtest-results">履歴更新</button>
          </div>
        </form>
        <div class="output" id="backtest-output"></div>
        <div class="backtest-history" id="backtest-history"></div>
        <div class="metrics" id="backtest-metrics"></div>
        <div class="chart-card">
          <canvas id="backtest-equity-chart" height="200"></canvas>
        </div>
        <div class="heatmap-card">
          <div class="heatmap-head">
            <strong>月別リターン</strong>
            <span class="label">色が濃いほど損益が大きい</span>
          </div>
          <div class="heatmap" id="backtest-heatmap"></div>
        </div>
        <div class="table-tools">
          <input type="search" id="backtest-filter" placeholder="フィルタ: 方向, 損益, 日付" />
          <select id="backtest-sort">
            <option value="date_desc">新しい順</option>
            <option value="date_asc">古い順</option>
            <option value="pnl_desc">損益 大きい順</option>
            <option value="pnl_asc">損益 小さい順</option>
          </select>
        </div>
        <div class="table-wrap">
          <table class="table" id="backtest-trades-table">
            <thead>
              <tr>
                <th>日時</th>
                <th>シンボル</th>
                <th>方向</th>
                <th>サイズ</th>
                <th>価格</th>
                <th title="この取引の損失/利益です">損益</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section class="card" id="news" data-step="10">
        <div class="card-head">
          <h2>ニュース分析</h2>
          <p>ニュースセンチメントとキーワードを可視化します。</p>
        </div>
        <div class="news-grid">
          <div class="news-panel">
            <h3>最新ニュース</h3>
            <div class="news-list" id="news-list"></div>
          </div>
          <div class="news-panel">
            <h3 title="ニュースがポジティブ/ネガティブかの目安です">センチメント推移（24h）</h3>
            <canvas id="news-sentiment-chart" height="160"></canvas>
          </div>
          <div class="news-panel">
            <h3 title="検出されたキーワードが多いほど大きく表示されます">キーワードクラウド</h3>
            <div class="tag-cloud" id="news-keywords"></div>
          </div>
        </div>
      </section>

      <section class="card" id="audit" data-step="11">
        <div class="card-head">
          <h2>監査ログ</h2>
          <p>リスク確認など重要な判断理由を分析できます。</p>
        </div>
        <div class="audit-summary" id="audit-summary"></div>
        <div class="audit-controls">
          <label>
            <span>イベント種別</span>
            <div class="chip-group" id="audit-event-chips">
              <label class="chip"><input type="checkbox" value="risk_check" checked />リスク確認</label>
              <label class="chip"><input type="checkbox" value="propose" checked />提案</label>
              <label class="chip"><input type="checkbox" value="approve" checked />承認</label>
              <label class="chip"><input type="checkbox" value="approve_execute" checked />承認+実行</label>
              <label class="chip"><input type="checkbox" value="execute" checked />実行</label>
              <label class="chip"><input type="checkbox" value="ingest" />取り込み</label>
              <label class="chip"><input type="checkbox" value="backtest" />バックテスト</label>
              <label class="chip"><input type="checkbox" value="report" />レポート</label>
              <label class="chip"><input type="checkbox" value="config_update" />設定変更</label>
              <label class="chip"><input type="checkbox" value="runner_start" />自動取り込み開始</label>
              <label class="chip"><input type="checkbox" value="runner_stop" />自動取り込み停止</label>
            </div>
          </label>
          <label>
            <span>開始日</span>
            <input type="date" id="audit-start" />
          </label>
          <label>
            <span>終了日</span>
            <input type="date" id="audit-end" />
          </label>
          <label>
            <span>提案ID</span>
            <input type="text" id="audit-intent" placeholder="提案IDで絞り込み" />
          </label>
          <div class="form-actions">
            <button class="btn btn-ghost" id="refresh-audit">更新</button>
            <button class="btn btn-ghost" id="export-audit-json">JSON出力</button>
            <button class="btn btn-ghost" id="export-audit-csv">CSV出力</button>
          </div>
        </div>
        <div class="timeline" id="audit-timeline"></div>
        <div class="audit-list" id="audit-list"></div>
      </section>

      <section class="card" id="guide" data-step="12">
        <div class="card-head">
          <h2>取引所切替の簡易ガイド</h2>
          <p>スポット対応・ローソク取得可否を基準に選択してください。</p>
        </div>
        <div class="guide">
          <div>
            <h3>おすすめ候補</h3>
            <ul>
              <li>bitflyer（現状のデフォルト、JPY対応）</li>
              <li>bitbank（JPY対応、板情報が安定しやすい）</li>
              <li>GMOコイン（JPY対応、要CCXT対応確認）</li>
            </ul>
          </div>
          <div>
            <h3>切替手順</h3>
            <ol>
              <li><code>config.yaml</code>の <strong>exchange.name</strong> を変更</li>
              <li>APIキーの環境変数名を合わせる</li>
              <li>ステータス画面で接続確認</li>
              <li>取り込み → 提案 → 承認 → 実行の順で確認</li>
            </ol>
          </div>
        </div>
      </section>
    </main>

    <div class="modal" id="alert-modal" aria-hidden="true">
      <div class="modal-backdrop" data-close="true"></div>
      <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="alert-modal-title">
        <div class="modal-head">
          <h3 id="alert-modal-title">アラート追加</h3>
          <button class="icon-button" type="button" data-close="true">×</button>
        </div>
        <form id="alert-form" class="form">
          <div class="form-grid">
            <label>
              <span>シンボル</span>
              <select id="alert-symbol"></select>
            </label>
            <label>
              <span>条件</span>
              <select id="alert-condition">
                <option value="above">価格が指定値以上</option>
                <option value="below">価格が指定値以下</option>
                <option value="change_pct">変動率が指定値以上</option>
              </select>
            </label>
            <label>
              <span>しきい値</span>
              <input type="number" id="alert-threshold" placeholder="価格 or 変動率(%)" step="0.1" />
            </label>
          </div>
          <div class="hint" id="alert-hint">変動率は % 指定です（例: 1.5）</div>
          <div class="modal-actions">
            <button class="btn btn-ghost" type="button" data-close="true">キャンセル</button>
            <button class="btn btn-primary" type="submit">追加する</button>
          </div>
        </form>
      </div>
    </div>

    <div class="modal" id="safety-modal" aria-hidden="true">
      <div class="modal-backdrop" data-close="true"></div>
      <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="safety-modal-title">
        <div class="modal-head">
          <h3 id="safety-modal-title">安全モード設定</h3>
          <button class="icon-button" type="button" data-close="true">×</button>
        </div>
        <form id="safety-form" class="form">
          <div class="form-grid">
            <label>
              <span title="練習モードは実際のお金を使いません">運用モード</span>
              <select id="safety-mode">
                <option value="paper">練習モード</option>
                <option value="live">本番モード</option>
              </select>
            </label>
            <label>
              <span title="実際の注文を出さずにシミュレーションします">練習モード設定</span>
              <select id="safety-dry-run">
                <option value="true">有効</option>
                <option value="false">無効</option>
              </select>
            </label>
            <label class="checkbox">
              <input type="checkbox" id="safety-require-approval" />
              <span title="実行前に人の確認が必要です">承認を必須にする</span>
            </label>
            <label class="checkbox">
              <input type="checkbox" id="safety-kill-switch" />
              <span title="すべての取引を緊急停止します">緊急停止を有効</span>
            </label>
            <label class="checkbox">
              <input type="checkbox" id="safety-autopilot" />
              <span title="条件を満たすと自動で実行します（既定はOFF）">自動実行（条件付き）</span>
            </label>
            <label class="checkbox">
              <input type="checkbox" id="safety-live-ack" />
              <span title="本番モードでの実行に必要な確認です">本番取引の確認</span>
            </label>
            <label>
              <span title="連続取引を抑えるための待機時間です">クールダウン（分）</span>
              <input type="number" id="safety-cooldown-minutes" min="0" step="1" />
            </label>
            <label>
              <span title="急変時のみクールダウンを解除する閾値です">急変時の解除閾値（%）</span>
              <input type="number" id="safety-cooldown-bypass" min="0" step="0.1" />
            </label>
            <label>
              <span title="1日の損失がこの金額に達すると取引停止します">日次損失上限（JPY）</span>
              <input type="number" id="safety-daily-loss" min="0" step="1000" />
            </label>
            <label>
              <span title="1日に実行できる注文の上限です">最大注文数/日</span>
              <input type="number" id="safety-max-orders" min="0" step="1" />
            </label>
          </div>
          <div class="hint">
            本番取引は <code>I_UNDERSTAND_LIVE_TRADING=true</code> と
            ここでのフラグ両方が必要です。
          </div>
          <div class="modal-actions">
            <button class="btn btn-ghost" type="button" data-close="true">キャンセル</button>
            <button class="btn btn-primary" type="submit">保存する</button>
          </div>
        </form>
      </div>
    </div>

    <div class="modal" id="frequency-modal" aria-hidden="true">
      <div class="modal-backdrop" data-close="true"></div>
      <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="frequency-modal-title">
        <div class="modal-head">
          <h3 id="frequency-modal-title">更新頻度設定</h3>
          <button class="icon-button" type="button" data-close="true">×</button>
        </div>
        <form id="frequency-form" class="form">
          <div class="form-grid">
            <label>
              <span>市場取り込み（秒）</span>
              <input type="number" id="runner-market-poll" min="5" step="1" />
            </label>
            <label>
              <span>ニュース取り込み（秒）</span>
              <input type="number" id="runner-news-poll" min="10" step="1" />
            </label>
            <label>
              <span>提案生成（秒）</span>
              <input type="number" id="runner-propose-poll" min="10" step="1" />
            </label>
            <label>
              <span>提案クールダウン（秒）</span>
              <input type="number" id="runner-propose-cooldown" min="0" step="10" />
            </label>
            <label>
              <span>UI更新（秒）</span>
              <input type="number" id="ui-refresh-poll" min="5" step="1" />
            </label>
            <label>
              <span>提案更新（秒）</span>
              <input type="number" id="ui-intent-poll" min="5" step="1" />
            </label>
          </div>
          <div class="hint">
            自動取り込みの反映は再起動が必要です。UI更新は即時反映されます。
          </div>
          <div class="modal-actions">
            <button class="btn btn-ghost" type="button" data-close="true">キャンセル</button>
            <button class="btn btn-primary" type="submit">保存する</button>
          </div>
        </form>
      </div>
    </div>

    <footer class="footer">
      <p>このUIはローカルで動作します。実運用の前に必ず練習モードで検証してください。</p>
    </footer>
  </body>
</html>
